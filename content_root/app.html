<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id"
          content="370606383019-jn3m29h3sq463rr42i3bv53v34vk4ups.apps.googleusercontent.com">
    <title>WS Demo</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          crossorigin="anonymous">
</head>
<body>
<div class="container" id="logout">
    <a href="#" onclick="logout()" id="logout"><div id="username">Logout</div></a>
</div>
<div class="container" id="log">
</div>
</body>
<script>
  function init () {
    gapi.load('auth2', () => {
      gapi.auth2.init()
        .then(gauthInitOK, gauthInitError)
    })
  }

  function gauthInitOK () {
    gapi.auth2.getAuthInstance()
      .then((ga) => {
        if (!ga.isSignedIn.get()) {
          alert('this app requires authentication')
          location.href = '/index.html'
        } else {
          const gu = ga.currentUser.get()
          let p = gu.getBasicProfile()
          if (p) {
            document.getElementById('username').innerText = `Logout ${p.getName()}`
          }
        }
      })
  }

  function gauthInitError (err) {
    console.log(err)
    alert('init error - check the console')
  }

  function logout () {
    disconnectNATS()
    gapi.auth2.getAuthInstance()
      .then((ga) => {
        ga.disconnect()
        alert('You have been logged out')
        location.href = '/index.html'
      })
  }
</script>
<script src="https://apis.google.com/js/platform.js?onload=init"></script>
<script src="./assets/nats.js"></script>
<script src="./app.js"></script>
</html>
